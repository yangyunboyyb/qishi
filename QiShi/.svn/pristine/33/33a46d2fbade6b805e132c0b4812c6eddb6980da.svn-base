{"version":3,"sources":["RankList.js"],"names":["Utils","require","cc","Class","extends","Component","properties","rankItemNode","Node","scrollView","ScrollView","labelLoading","Label","rankItemPre","Prefab","indexImg","SpriteFrame","gameOver","friendNode","start","wx","onMessage","data","messageType","active","fetchFriendData","MAIN_MENU_NUM","gameOverData","removeChild","content","removeAllChildren","node","string","getUserInfo","openIdList","lang","success","userRes","userdata","getFriendCloudStorage","keyList","res","console","log","sort","a","b","KVDataList","length","value","index_","i","playerInfo","avatarUrl","showMeRank","item","instantiate","getComponent","init","addChild","fail","index","labelName","getChildByName","labelRank","imgrank","Sprite","labelmoney","nickname","imgheadurl","createImage","grade","JSON","stringify","spriteFrame","msg","curScore","showOtherScore","head","label"],"mappings":"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","file":"RankList.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["let Utils = require(\"Utils\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        rankItemNode: cc.Node,\r\n        scrollView: cc.ScrollView,\r\n        labelLoading: cc.Label,\r\n        rankItemPre: cc.Prefab,\r\n        indexImg: [cc.SpriteFrame],\r\n\r\n        gameOver: cc.Node,\r\n        friendNode: cc.Node,\r\n    },\r\n\r\n    start() {\r\n        wx.onMessage(data => {\r\n            if (data.messageType == 2) {\r\n                this.gameOver.active = false;\r\n                this.friendNode.active = true;\r\n                this.fetchFriendData(data.MAIN_MENU_NUM);\r\n            } else if(data.messageType == 1){\r\n                this.gameOver.active = true;\r\n                this.friendNode.active = false;\r\n                this.gameOverData(data);\r\n            }\r\n        });\r\n    },\r\n\r\n    removeChild: function () {\r\n        this.scrollView.content.removeAllChildren();\r\n        this.rankItemNode.active = false;\r\n        this.labelLoading.node.active = true;\r\n        this.labelLoading.string = \"加载中...\";\r\n    },\r\n\r\n    fetchFriendData: function (MAIN_MENU_NUM) {\r\n        this.removeChild();\r\n        wx.getUserInfo({\r\n            openIdList: ['selfOpenId'],\r\n            lang: 'zh_CN',\r\n            success: (userRes) => {\r\n                this.labelLoading.node.active = false;\r\n                let userdata = userRes.data[0];\r\n                wx.getFriendCloudStorage({\r\n                    keyList: [MAIN_MENU_NUM],\r\n                    success: (res) => {\r\n                        this.labelLoading.node.active = false;\r\n                        console.log(\"-------success getFriendCloudStorage----->\", res);\r\n                        let data = res.data;\r\n                        data.sort((a, b) => {\r\n                            if (!a) {\r\n                                return 1;\r\n                            }\r\n                            if (!b) {\r\n                                return -1;\r\n                            }\r\n                            if (!a.KVDataList) {\r\n                                return 1;\r\n                            }\r\n                            if (!b.KVDataList) {\r\n                                return -1;\r\n                            }\r\n                            if (a.KVDataList.length == 0) {\r\n                                return 1;\r\n                            }\r\n                            if (b.KVDataList.length == 0) {\r\n                                return -1;\r\n                            }\r\n                            if (a.KVDataList.length == 0 || b.KVDataList.length == 0) {\r\n                                return 0;\r\n                            }\r\n\r\n                            return b.KVDataList[0].value - a.KVDataList[0].value;\r\n                        });\r\n                        let index_ = 0;\r\n                        for (let i in data) {\r\n                            var playerInfo = data[i];\r\n                            if (!playerInfo) {\r\n                                continue;\r\n                            }\r\n                            if (playerInfo.KVDataList.length == 0) {\r\n                                continue;\r\n                            }\r\n                            if (userdata.avatarUrl == playerInfo.avatarUrl) {\r\n                                this.showMeRank(playerInfo, index_);\r\n                            }\r\n                            var item = cc.instantiate(this.rankItemPre);\r\n                            item.getComponent('RankItem').init(index_, playerInfo, this.indexImg);\r\n                            this.scrollView.content.addChild(item);\r\n\r\n                            index_++;\r\n                        }\r\n                    },\r\n                    fail: (res) => {\r\n                        this.labelLoading.active = true;\r\n                        this.labelLoading.string = \"加载失败...\";\r\n                    },\r\n                });\r\n            },\r\n            fail: (res) => {\r\n                this.labelLoading.active = true;\r\n                this.labelLoading.string = \"加载失败...\";\r\n            },\r\n        });\r\n    },\r\n\r\n    showMeRank: function (data, index) {\r\n        this.rankItemNode.active = true;\r\n        var labelName = this.rankItemNode.getChildByName(\"nickname\").getComponent(cc.Label);\r\n        var labelRank = this.rankItemNode.getChildByName(\"ranklabel\").getComponent(cc.Label);\r\n        var imgrank = this.rankItemNode.getChildByName(\"imgrank\").getComponent(cc.Sprite);\r\n        var labelmoney = this.rankItemNode.getChildByName(\"labelscore\").getComponent(cc.Label);\r\n\r\n        labelName.string = data.nickname;\r\n        var imgheadurl = data.avatarUrl;\r\n        Utils.createImage(imgheadurl, this.rankItemNode.getChildByName(\"headspr\").getComponent(cc.Sprite));\r\n\r\n        let grade = \"0\";\r\n        if (data.KVDataList && JSON.stringify(data.KVDataList) != '{}') {\r\n            grade = data.KVDataList[0].value;\r\n        }\r\n        labelmoney.string = grade + \"分\";\r\n\r\n        if (index < 3) {\r\n            labelRank.node.active = false;\r\n            imgrank.node.active = true;\r\n            imgrank.spriteFrame = this.indexImg[index]\r\n        } else {\r\n            imgrank.node.active = false;\r\n            labelRank.node.active = true;\r\n            labelRank.string = index + 1;\r\n        }\r\n    },\r\n\r\n    //游戏结束\r\n    gameOverData: function (msg) {  //curScore\r\n        wx.getUserInfo({\r\n            openIdList: ['selfOpenId'],\r\n            lang: 'zh_CN',\r\n            success: (userRes) => {\r\n                this.gameOver.active = true;\r\n                let userdata = userRes.data[0];\r\n                wx.getFriendCloudStorage({\r\n                    keyList: [msg.MAIN_MENU_NUM],\r\n                    success: (res) => {\r\n                        this.gameOver.active = true;\r\n                        console.log(\"-------success getFriendCloudStorage----->\", res);\r\n                        let data = res.data;\r\n                        for (let i in data) {\r\n                            if (userdata.avatarUrl ==  data[i].avatarUrl) {\r\n                                data[i].KVDataList[0].value = msg.curScore;\r\n                            }\r\n                        }\r\n                        data.sort((a, b) => {\r\n                            if (!a) {\r\n                                return 1;\r\n                            }\r\n                            if (!b) {\r\n                                return -1;\r\n                            }\r\n                            if (!a.KVDataList) {\r\n                                return 1;\r\n                            }\r\n                            if (!b.KVDataList) {\r\n                                return -1;\r\n                            }\r\n                            if (a.KVDataList.length == 0) {\r\n                                return 1;\r\n                            }\r\n                            if (b.KVDataList.length == 0) {\r\n                                return -1;\r\n                            }\r\n                            if (a.KVDataList.length == 0 || b.KVDataList.length == 0) {\r\n                                return 0;\r\n                            }\r\n                            return b.KVDataList[0].value - a.KVDataList[0].value;\r\n                        });\r\n                        let index_ = 0;\r\n                        for (let i in data) {\r\n                            if (userdata.avatarUrl ==  data[i].avatarUrl) {\r\n                                break;\r\n                            }\r\n                            index_ ++;\r\n                        }\r\n                       \r\n                        this.showOtherScore(this.gameOver.getChildByName(\"smallnode\"),data[index_+1]);\r\n                        this.showOtherScore(this.gameOver.getChildByName(\"bignode\"),data[index_-1]);\r\n                    },\r\n                    fail: (res) => {\r\n                        this.gameOver.active = false;\r\n                    },\r\n                });\r\n            },\r\n            fail: (res) => {\r\n                this.gameOver.active = false;\r\n            },\r\n        });\r\n    },\r\n\r\n    showOtherScore:function(node,data){\r\n        if(data){\r\n            var imgheadurl = data.avatarUrl;\r\n            var head = node.getChildByName(\"userhead\").getChildByName(\"mask\").getChildByName(\"headspr\").getComponent(cc.Sprite);\r\n            Utils.createImage(imgheadurl, head);\r\n            var label = node.getChildByName(\"labelscore\").getComponent(cc.Label);\r\n            let grade = \"0\";\r\n            if (data.KVDataList && JSON.stringify(data.KVDataList) != '{}') {\r\n                grade = data.KVDataList[0].value;\r\n            }\r\n            label.string = grade;\r\n        }else{\r\n            node.active = false;\r\n        }\r\n    },\r\n});\r\n"]}